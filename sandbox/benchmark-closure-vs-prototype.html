<html>
<head>
<title>Becnhmark - Javascript prototype versus closure execution speed</title>
<script type="text/javascript">
/*
 * Author: Rodrigo Augosto C. (coto) <contact@protoboard.cl>
 * Twitter: http://twitter.com/coto
 * URL: http://protoboard.cl
 * Created: Nov 30, 2010
 */

// Prototype implementation
function PixelP(x, y) {
	this.x = x;
	this.y = y;
}
PixelP.prototype.getX = function() {
	return this.x;
}
PixelP.prototype.getY = function() {
	return this.y;
}
PixelP.prototype.setX = function(value) {
	this.x = value;
}
PixelP.prototype.setY = function(value) {
	this.y = value;
}

// Closure implementation
function Pixel(x, y) {
	this.x = x;
	this.y = y;
	this.getX = function() {
		return this.x;
	}
	this.getY = function() {
		return this.y;
	}
	this.setX = function(value) {
		this.x = value;
	}
	this.setY = function(value) {
		this.y = value;
	}
}

const CYCLES = 20000000;
 
 
function TestPerformance() {
	// Testing Instance
	var prototypeStartDateTime = new Date();
	for (var i = 0; i < CYCLES; i++) {
		var x = new PixelP(i, i);   
	}
	var prototypeEndDateTime = new Date();


	var closureStartDateTime = new Date();
	for (var i = 0; i < CYCLES; i++) {
		var x = new Pixel(i, i);   
	}
	var closureEndDateTime = new Date();

	var closureTime = closureEndDateTime.getTime() - closureStartDateTime.getTime();
	var prototypeTime = prototypeEndDateTime.getTime() - prototypeStartDateTime.getTime();
	console.log("Instance Benchmark");
	document.write("<h2>Instance Benchmark</h2>");	
	console.log("Closure time: " + closureTime + ", Prototype time: " + prototypeTime);
	document.write("Closure time: " + closureTime + "<br> Prototype time: " + prototypeTime + "<hr/>");


	// Testing Execution
	var prototypeExecStartDateTime, prototypeExecEndDateTime
	function getTimePrototype() {
		var cl2 = new PixelP(1, 1000); 
		prototypeExecStartDateTime = new Date();
		for (var i = 0; i < CYCLES; i++) {
			cl2.setX('hola');
		}
		prototypeExecEndDateTime = new Date();
	}

	var closureExecStartDateTime, closureExecEndDateTime
	function getTimeClosure(){
		var cl1 = new Pixel(1, 1000); 
		closureExecStartDateTime = new Date();
		for (var i = 0; i < CYCLES; i++) {
			cl1.setX('hola');
		}
		closureExecEndDateTime = new Date();
	}

	getTimePrototype();
	getTimeClosure();

	var closureExecTime = closureExecEndDateTime.getTime() - closureExecStartDateTime.getTime();
	var prototypeExecTime = prototypeExecEndDateTime.getTime() - prototypeExecStartDateTime.getTime();
	console.log("Execution Benchmark");
	document.write("<h2>Execution Benchmark</h2>");
	console.log("Closure time: " + closureExecTime + ", Prototype time: " + prototypeExecTime);
	document.write("Closure time: " + closureExecTime + "<br/> Prototype time: " + prototypeExecTime + "<hr/>");
}

TestPerformance();
</script>
</head>
<body>
</body>
</html>